# Drift 产品设计说明

## 设计目标
Drift 目标是让“缓慢失衡”被及早看见，而不是提供医疗诊断或绩效管理。
关键设计原则：
- 极低交互负担：每天打卡在 10 秒内完成。
- 趋势优先：强调连续变化，不放大单日波动。
- 可解释提醒：每次提醒都说明触发原因。

## 方案备选与权衡
### 方案 A：纯规则引擎（推荐，MVP）
- 做法：固定阈值 + 简单趋势统计（均值、斜率、连续性）。
- 优点：快、可解释、易验证、风险低。
- 缺点：个体差异适配弱，长期精度有限。

### 方案 B：规则 + 个体基线
- 做法：先建 2-4 周个人基线，再用偏离程度触发。
- 优点：个体化更强，误报下降。
- 缺点：冷启动复杂，MVP 上线速度下降。

### 方案 C：端到端 AI 评分
- 做法：由模型直接生成风险评分与建议。
- 优点：表达丰富，个性化高。
- 缺点：可解释性与稳定性风险高，成本高，不适合首版。

推荐顺序：MVP 采用 A，V1 过渡到 B，Pro 再引入 C 的分析能力。

## 交互与信息架构
- `Check-in`：唯一主入口，完成 3-4 个指标打卡。
- `Trends`：7/30 天趋势，显示变化方向与漂移指数。
- `Alerts`：按时间列出提醒、原因与建议。
- `Settings`：提醒时间、时区、隐私与导出。

## 关键数据流
1. 用户提交打卡 -> 写入 `daily_checkins`。
2. Drift Engine 读取近窗数据 -> 生成 `drift_scores`。
3. 超阈值 -> 生成 `alerts`。
4. 定时任务读取提醒策略 -> 发送通知并记录日志。

## 失败与边界处理
- 漏打卡：允许当天补录；趋势图显示缺失点，不插值伪造。
- 极端值：范围校验（1-5），非法请求拒绝。
- 误触发反馈：后续加入“这条提醒是否有帮助”用于调参。

## 测试与验收策略
- 单元测试：规则函数、指数合成、模板映射。
- API 测试：创建打卡、重复校验、趋势查询、提醒生成。
- E2E：从打卡到趋势查看到提醒可见的主链路。
- 验收口径：
  - 打卡成功率 > 99%
  - 关键页面 P95 < 1.5s
  - 提醒具备可解释原因字段
